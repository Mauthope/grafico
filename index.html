<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Ações e Gráficos</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div>
        <button onclick="limparLocalStorage()">Limpar Dados</button>
    </div>

    <div>
        <div>
            <h3>Seção 1</h3>
            <table id="tabelaAcoes1">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Eficiência</th>
                        <th>Resíduo</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Tabela de Ações -->
                </tbody>
            </table>
            <canvas id="chart1"></canvas>
            <canvas id="chart2"></canvas>
            <p id="media1"></p>
        </div>
        <div>
            <h3>Seção 2</h3>
            <table id="tabelaAcoes2">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Eficiência</th>
                        <th>Resíduo</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Tabela de Ações -->
                </tbody>
            </table>
            <canvas id="chart3"></canvas>
            <canvas id="chart4"></canvas>
            <p id="media2"></p>
        </div>
        <div>
            <h3>Seção 3</h3>
            <table id="tabelaAcoes3">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Eficiência</th>
                        <th>Resíduo</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Tabela de Ações -->
                </tbody>
            </table>
            <canvas id="chart5"></canvas>
            <canvas id="chart6"></canvas>
            <p id="media3"></p>
        </div>
    </div>

    <script>
        let dados = [
            [{ data: '01/01/2024', eficiencia: 85, residuo: 12 }, { data: '02/01/2024', eficiencia: 90, residuo: 10 }],
            [{ data: '01/01/2024', eficiencia: 80, residuo: 15 }, { data: '02/01/2024', eficiencia: 82, residuo: 13 }],
            [{ data: '01/01/2024', eficiencia: 88, residuo: 11 }, { data: '02/01/2024', eficiencia: 89, residuo: 9 }]
        ];
        let acoesTaxadas = [[], [], []]; // Ações tachadas

        // Atualiza a tabela de cada seção
        function atualizarTabela(secao) {
            const tabela = document.getElementById(`tabelaAcoes${secao}`);
            const tbody = tabela.querySelector('tbody');
            tbody.innerHTML = '';
            dados[secao - 1].forEach((item, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${item.data}</td>
                    <td>${item.eficiencia}</td>
                    <td>${item.residuo}</td>
                    <td>
                        <button onclick="tacharAcao(${secao}, ${index})">${acoesTaxadas[secao - 1][index].length ? 'Desmarcar' : 'Marcar'} Ação</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            exibirMedia(secao); // Atualiza a média abaixo do gráfico
        }

        // Marca ou desmarca a ação
        function tacharAcao(secao, index) {
            const acoes = acoesTaxadas[secao - 1];
            const acaoIndex = acoes[index].length;
            if (acaoIndex) {
                acoes[index].pop();  // Remove ação tachada
            } else {
                acoes[index].push(true);  // Marca ação como tachada
            }

            // Atualiza localStorage
            localStorage.setItem(`acoesTaxadasSecao${secao}`, JSON.stringify(acoes));

            atualizarTabela(secao);
        }

        // Função para gerar os gráficos
        function gerarGrafico(secao) {
            const ctx1 = document.getElementById(`chart${secao * 2 - 1}`).getContext('2d');
            const ctx2 = document.getElementById(`chart${secao * 2}`).getContext('2d');

            const eficiencia = dados[secao - 1].map(item => item.eficiencia);
            const residuo = dados[secao - 1].map(item => item.residuo);

            // Gráfico de Eficiência
            new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: dados[secao - 1].map(item => item.data),
                    datasets: [{
                        label: 'Eficiência',
                        data: eficiencia,
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });

            // Gráfico de Resíduo
            new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: dados[secao - 1].map(item => item.data),
                    datasets: [{
                        label: 'Resíduo',
                        data: residuo,
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        // Função para calcular e exibir a média
        function exibirMedia(secao) {
            const eficiencia = dados[secao - 1].map(item => item.eficiencia);
            const residuo = dados[secao - 1].map(item => item.residuo);

            const mediaEficiencia = (eficiencia.reduce((acc, val) => acc + val, 0) / eficiencia.length).toFixed(2);
            const mediaResiduo = (residuo.reduce((acc, val) => acc + val, 0) / residuo.length).toFixed(2);

            document.getElementById(`media${secao}`).innerHTML = `
                <strong>Média Eficiência:</strong> ${mediaEficiencia}% 
                <strong>Média Resíduo:</strong> ${mediaResiduo}%
            `;
        }

        // Limpa o localStorage
        function limparLocalStorage() {
            localStorage.clear();
            dados = [[], [], []];
            acoesTaxadas = [[], [], []];
            atualizarTabela(1);
            atualizarTabela(2);
            atualizarTabela(3);
            gerarGrafico(1);
            gerarGrafico(2);
            gerarGrafico(3);
        }

        // Inicializa as tabelas e gráficos ao carregar a página
        window.onload = () => {
            atualizarTabela(1);
            atualizarTabela(2);
            atualizarTabela(3);
            gerarGrafico(1);
            gerarGrafico(2);
            gerarGrafico(3);
        };
    </script>
</body>
</html>
